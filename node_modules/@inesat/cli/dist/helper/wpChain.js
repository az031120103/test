"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getConfig = exports.WPChain = void 0;
const webpack_chain_1 = __importDefault(require("webpack-chain"));
exports.WPChain = webpack_chain_1.default;
const store_1 = __importDefault(require("./store"));
const fs_extra_1 = __importDefault(require("fs-extra"));
const logger_1 = __importDefault(require("./logger"));
const wpChain = new webpack_chain_1.default();
const getConfig = () => {
    if (store_1.default.config.webpack) {
        wpChain.merge(store_1.default.config.webpack);
    }
    const conf = wpChain.toConfig();
    const { wplogger } = store_1.default.config.debug;
    if (wplogger && !store_1.default.config.build.lib) {
        if (typeof wplogger === 'string') {
            fs_extra_1.default.writeFile(store_1.default.resolve(wplogger), `module.exports=${JSON.stringify(conf, null, 2)}`).catch(e => logger_1.default.error(e));
        }
        else {
            logger_1.default.info('[webpack config]', JSON.stringify(conf, null, 2));
        }
    }
    return conf;
};
exports.getConfig = getConfig;
exports.default = wpChain;
//# sourceMappingURL=wpChain.js.map